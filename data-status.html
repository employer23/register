<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>æ•°æ®çŠ¶æ€æ£€æŸ¥</title>
    <link rel="stylesheet" href="style.css">
    <style>
        .status-container {
            max-width: 800px;
            margin: 40px auto;
            padding: 20px;
        }
        .status-card {
            background: white;
            border-radius: 16px;
            box-shadow: 0 4px 12px rgba(0,0,0,0.1);
            padding: 30px;
            margin-bottom: 20px;
        }
        .status-ok { border-left: 5px solid #48bb78; }
        .status-warning { border-left: 5px solid #ed8936; }
        .status-error { border-left: 5px solid #e53e3e; }
        .data-count {
            font-size: 2rem;
            font-weight: bold;
            color: #667eea;
            margin: 10px 0;
        }
        .btn-group {
            display: flex;
            gap: 10px;
            flex-wrap: wrap;
            margin-top: 20px;
        }
        .btn {
            padding: 10px 20px;
            border-radius: 8px;
            text-decoration: none;
            font-weight: 500;
            transition: transform 0.2s;
        }
        .btn:hover { transform: translateY(-1px); }
        .btn-primary { background: #667eea; color: white; }
        .btn-success { background: #48bb78; color: white; }
        .btn-warning { background: #ed8936; color: white; }
        .data-preview {
            background: #f8fafc;
            border-radius: 8px;
            padding: 15px;
            margin-top: 15px;
            max-height: 200px;
            overflow-y: auto;
            font-family: monospace;
            font-size: 0.9rem;
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="status-container">
            <h1 style="text-align: center; color: #2d3748; margin-bottom: 40px;">ğŸ“Š æ•°æ®çŠ¶æ€æ£€æŸ¥</h1>

            <!-- æœ¬åœ°æ•°æ®æ£€æŸ¥ -->
            <div class="status-card" id="localDataCard">
                <h3>ğŸ–¥ï¸ æœ¬åœ°æµè§ˆå™¨æ•°æ® (localStorage)</h3>
                <div class="data-count" id="localCount">æ£€æŸ¥ä¸­...</div>
                <p id="localStatus">æ­£åœ¨æ£€æŸ¥æœ¬åœ°å­˜å‚¨çš„æŠ¥åæ•°æ®...</p>
                <div id="localPreview" class="data-preview" style="display: none;"></div>
                <div class="btn-group">
                    <button onclick="exportLocalData()" class="btn btn-warning" id="exportBtn" disabled>å¯¼å‡ºæœ¬åœ°æ•°æ®</button>
                    <a href="admin.html" class="btn btn-primary">æŸ¥çœ‹æœ¬åœ°æ•°æ®ç®¡ç†</a>
                </div>
            </div>

            <!-- Netlify Forms çŠ¶æ€ -->
            <div class="status-card status-ok">
                <h3>â˜ï¸ Netlify Forms äº‘ç«¯æ•°æ®</h3>
                <div class="data-count">âœ… å·²å¯ç”¨</div>
                <p>æ–°çš„æŠ¥åæ•°æ®å°†è‡ªåŠ¨ä¿å­˜åˆ° Netlify äº‘ç«¯ï¼Œæ”¯æŒè·¨è®¾å¤‡è®¿é—®ã€‚</p>
                <div class="btn-group">
                    <a href="https://app.netlify.com/" target="_blank" class="btn btn-success">æ‰“å¼€ Netlify åå°</a>
                    <a href="admin-netlify.html" class="btn btn-primary">æŸ¥çœ‹ä½¿ç”¨æŒ‡å—</a>
                </div>
            </div>

            <!-- è¡¨å•çŠ¶æ€æ£€æŸ¥ -->
            <div class="status-card" id="formStatusCard">
                <h3>ğŸ“ è¡¨å•é…ç½®çŠ¶æ€</h3>
                <div id="formStatus">æ£€æŸ¥ä¸­...</div>
                <div class="btn-group">
                    <a href="index.html" class="btn btn-primary">è®¿é—®æŠ¥åé¡µé¢</a>
                    <button onclick="testFormSubmission()" class="btn btn-warning">æµ‹è¯•è¡¨å•æäº¤</button>
                </div>
            </div>

            <!-- æ“ä½œå»ºè®® -->
            <div class="status-card status-warning">
                <h3>ğŸ¯ æ“ä½œå»ºè®®</h3>
                <ol style="line-height: 1.8;">
                    <li><strong>å¦‚æœæœ‰æœ¬åœ°æ•°æ®</strong>ï¼šç‚¹å‡»"å¯¼å‡ºæœ¬åœ°æ•°æ®"ä¿å­˜å¤‡ä»½</li>
                    <li><strong>æµ‹è¯•æ–°è¡¨å•</strong>ï¼šæäº¤ä¸€æ¡æµ‹è¯•æŠ¥åï¼Œæ£€æŸ¥æ˜¯å¦æ­£å¸¸</li>
                    <li><strong>æŸ¥çœ‹ Netlify æ•°æ®</strong>ï¼šåœ¨ Netlify åå°æŸ¥çœ‹æ–°çš„æŠ¥å</li>
                    <li><strong>ä»¥åç®¡ç†æ•°æ®</strong>ï¼šä½¿ç”¨ Netlify åå°ï¼Œä¸å†ä¾èµ–æœ¬åœ°å­˜å‚¨</li>
                </ol>
            </div>
        </div>
    </div>

    <script>
        // æ£€æŸ¥æœ¬åœ°æ•°æ®
        function checkLocalData() {
            const localData = localStorage.getItem('registrations');
            const localCard = document.getElementById('localDataCard');
            const localCount = document.getElementById('localCount');
            const localStatus = document.getElementById('localStatus');
            const localPreview = document.getElementById('localPreview');
            const exportBtn = document.getElementById('exportBtn');

            if (localData) {
                try {
                    const data = JSON.parse(localData);
                    const count = data.length;
                    
                    localCount.textContent = `${count} æ¡è®°å½•`;
                    localStatus.innerHTML = `å‘ç° <strong>${count}</strong> æ¡æœ¬åœ°å­˜å‚¨çš„æŠ¥åè®°å½•ã€‚è¿™äº›æ•°æ®åªåœ¨å½“å‰æµè§ˆå™¨å¯è§ã€‚`;
                    
                    // æ˜¾ç¤ºæ•°æ®é¢„è§ˆ
                    localPreview.style.display = 'block';
                    localPreview.textContent = JSON.stringify(data.slice(0, 3), null, 2) + (count > 3 ? '\n...(æ›´å¤šæ•°æ®)' : '');
                    
                    localCard.className = 'status-card status-warning';
                    exportBtn.disabled = false;
                } catch (e) {
                    localCount.textContent = 'æ•°æ®æŸå';
                    localStatus.textContent = 'æœ¬åœ°æ•°æ®æ ¼å¼é”™è¯¯ï¼Œæ— æ³•è¯»å–ã€‚';
                    localCard.className = 'status-card status-error';
                }
            } else {
                localCount.textContent = '0 æ¡è®°å½•';
                localStatus.textContent = 'å½“å‰æµè§ˆå™¨æ²¡æœ‰æœ¬åœ°å­˜å‚¨çš„æŠ¥åæ•°æ®ï¼Œæˆ–è€…æ•°æ®å·²è¢«æ¸…é™¤ã€‚';
                localCard.className = 'status-card status-ok';
            }
        }

        // å¯¼å‡ºæœ¬åœ°æ•°æ®
        function exportLocalData() {
            const localData = localStorage.getItem('registrations');
            if (!localData) {
                alert('æ²¡æœ‰æœ¬åœ°æ•°æ®å¯å¯¼å‡º');
                return;
            }

            try {
                const data = JSON.parse(localData);
                const blob = new Blob([JSON.stringify(data, null, 2)], { type: 'application/json' });
                const url = URL.createObjectURL(blob);
                const a = document.createElement('a');
                a.href = url;
                a.download = `local-registrations-backup-${new Date().toISOString().slice(0,10)}.json`;
                a.click();
                URL.revokeObjectURL(url);
                
                alert('æœ¬åœ°æ•°æ®å·²å¯¼å‡ºï¼å»ºè®®ä¿å­˜å¥½å¤‡ä»½æ–‡ä»¶ã€‚');
            } catch (e) {
                alert('å¯¼å‡ºå¤±è´¥ï¼š' + e.message);
            }
        }

        // æ£€æŸ¥è¡¨å•é…ç½®
        function checkFormStatus() {
            fetch('index.html')
                .then(response => response.text())
                .then(html => {
                    const formStatus = document.getElementById('formStatus');
                    if (html.includes('data-netlify="true"')) {
                        formStatus.innerHTML = 'âœ… è¡¨å•å·²æ­£ç¡®é…ç½® Netlify Formsï¼Œæ–°æŠ¥åå°†è‡ªåŠ¨ä¿å­˜åˆ°äº‘ç«¯ã€‚';
                        document.getElementById('formStatusCard').className = 'status-card status-ok';
                    } else {
                        formStatus.innerHTML = 'âŒ è¡¨å•é…ç½®å¯èƒ½æœ‰é—®é¢˜ï¼Œè¯·æ£€æŸ¥æ˜¯å¦åŒ…å« data-netlify="true" å±æ€§ã€‚';
                        document.getElementById('formStatusCard').className = 'status-card status-error';
                    }
                })
                .catch(e => {
                    document.getElementById('formStatus').innerHTML = 'âš ï¸ æ— æ³•æ£€æŸ¥è¡¨å•é…ç½®çŠ¶æ€ã€‚';
                    document.getElementById('formStatusCard').className = 'status-card status-warning';
                });
        }

        // æµ‹è¯•è¡¨å•æäº¤
        function testFormSubmission() {
            alert('è¯·æ‰‹åŠ¨è®¿é—®æŠ¥åé¡µé¢ï¼Œå¡«å†™ä¸€æ¡æµ‹è¯•æ•°æ®ï¼Œç„¶ååˆ° Netlify åå°æŸ¥çœ‹æ˜¯å¦æ”¶åˆ°æ•°æ®ã€‚');
            window.open('index.html', '_blank');
        }

        // é¡µé¢åŠ è½½æ—¶æ‰§è¡Œæ£€æŸ¥
        window.onload = function() {
            checkLocalData();
            checkFormStatus();
        };
    </script>
</body>
</html>
